CREATE PROCEDURE CRM_ACCOUNT_AFFILIATE_Customer_AdminWeb
    @MEMBERID BIGINT = 0,
    @STARTDATE VARCHAR(20) = NULL,
    @ENDDATE VARCHAR(20) = NULL,
    @PAGEINDEX INT = 1,
    @PAGESIZE INT = 25
AS 
BEGIN

    DECLARE @FROMDATE DATETIME = NULL;
    DECLARE @TODATE DATETIME = NULL;

    IF ISNULL(@STARTDATE,'') <> '' SET @FROMDATE = TRY_CONVERT(DATETIME,@STARTDATE,103)
	IF ISNULL(@ENDDATE,'') <> '' SET @TODATE = TRY_CONVERT(DATETIME,@ENDDATE,103);


    SELECT 
            FORMAT(CRM_ACCOUNT.CREATEDDATE, 'dd/MM/yyy HH:mm:ss') CREATEDDATEVIEW,
            CRM_ACCOUNT.MEMBERID,
            CRM_ACCOUNT.CUSTOMERCODE,
            CONCAT(CRM_ACCOUNT.CUSTOMERCODE, '-', CRM_ACCOUNT.FULLNAME) FULLNAME,
            0 TOTALAMOUNT,
            0 TOTALCOMMISION,
            COUNT(1) OVER() AS TOTALITEMS
    FROM    CRM_ACCOUNT
    WHERE   CRM_ACCOUNT.ISACTIVE = 1
    AND     CRM_ACCOUNT.ISDELETED = 0
    AND     CRM_ACCOUNT.REFERRALCODE = @MEMBERID

    ORDER BY CRM_ACCOUNT.CREATEDDATE DESC 
    OFFSET      (@PAGEINDEX -1)* @PAGESIZE ROWS
	FETCH NEXT  @PAGESIZE ROWS ONLY
END