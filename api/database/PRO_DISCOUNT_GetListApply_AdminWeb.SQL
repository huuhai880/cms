ALTER PROCEDURE PRO_DISCOUNT_GetListApply_AdminWeb
    @MEMBERID BIGINT = 0
AS
BEGIN

    SELECT 
            PRO_DISCOUNT.DISCOUNTID,
            PRO_DISCOUNT.DISCOUNTCODE,
            PRO_DISCOUNT.ISPERCENTDISCOUNT,
            PRO_DISCOUNT.ISMONEYDISCOUNT,
            PRO_DISCOUNT.DISCOUNTVALUE,
            PRO_DISCOUNT.DISCOUNTSTATUS,
            PRO_DISCOUNT.ISALLPRODUCT,
            PRO_DISCOUNT.ISAPPOINTPRODUCT,
            PRO_DISCOUNT.ISALLCUSTOMERTYPE,
            PRO_DISCOUNT.ISAPPOINTCUSTOMERTYPE,
            PRO_DISCOUNT.ISNONEREQUIREMENT,
            PRO_DISCOUNT.ISMINTOTALMONEY,
            PRO_DISCOUNT.VALUEMINTOTALMONEY,
            PRO_DISCOUNT.ISMINNUMPRODUCT,
            PRO_DISCOUNT.VALUEMINNUMPRODUCT,
            FORMAT(PRO_DISCOUNT.STARTDATE, 'dd/MM/yyyy')STARTDATE,
            FORMAT(PRO_DISCOUNT.ENDDATE, 'dd/MM/yyyy') ENDDATE

    FROM    PRO_DISCOUNT
    WHERE   PRO_DISCOUNT.ISDELETED = 0
    AND     PRO_DISCOUNT.ISACTIVE = 1
    AND     (CAST(CAST(GETDATE() AS DATE) AS DATETIME) >= PRO_DISCOUNT.STARTDATE)
    AND     (
                CAST(CAST(GETDATE() AS DATE) AS DATETIME) <= PRO_DISCOUNT.ENDDATE
                OR PRO_DISCOUNT.ENDDATE IS NULL
            )

    SELECT 
            PRO_DISCOUNT_PRODUCT.DISCOUNTID,
            PRO_DISCOUNT_PRODUCT.DISCOUNTPRODUCTID,
            PRO_DISCOUNT_PRODUCT.PRODUCTID,
            PRO_DISCOUNT_PRODUCT.COMBOID
    FROM    PRO_DISCOUNT_PRODUCT
    WHERE   PRO_DISCOUNT_PRODUCT.ISACTIVE = 1
    AND     PRO_DISCOUNT_PRODUCT.ISDELETED = 0
    AND     EXISTS 
            (
                SELECT 1
                FROM    PRO_DISCOUNT
                WHERE   PRO_DISCOUNT.ISDELETED = 0
                AND     PRO_DISCOUNT.ISACTIVE = 1
                AND     (CAST(CAST(GETDATE() AS DATE) AS DATETIME) >= PRO_DISCOUNT.STARTDATE)
                AND     (
                            CAST(CAST(GETDATE() AS DATE) AS DATETIME) <= PRO_DISCOUNT.ENDDATE
                            OR PRO_DISCOUNT.ENDDATE IS NULL
                        )
                AND     PRO_DISCOUNT.DISCOUNTID = PRO_DISCOUNT_PRODUCT.DISCOUNTID
            )

    SELECT 
            PRO_DISCOUNT_CUSTOMERTYPE.CUSTOMERTYPEID,
            PRO_DISCOUNT_CUSTOMERTYPE.DISCOUNTCUSTOMERTYPETID,
            PRO_DISCOUNT_CUSTOMERTYPE.DISCOUNTID
    FROM    PRO_DISCOUNT_CUSTOMERTYPE
    WHERE   PRO_DISCOUNT_CUSTOMERTYPE.ISACTIVE = 1
    AND     PRO_DISCOUNT_CUSTOMERTYPE.ISDELETED = 0
    AND     EXISTS 
            (
                SELECT 1
                FROM    PRO_DISCOUNT
                WHERE   PRO_DISCOUNT.ISDELETED = 0
                AND     PRO_DISCOUNT.ISACTIVE = 1
                AND     (CAST(CAST(GETDATE() AS DATE) AS DATETIME) >= PRO_DISCOUNT.STARTDATE)
                AND     (
                            CAST(CAST(GETDATE() AS DATE) AS DATETIME) <= PRO_DISCOUNT.ENDDATE
                            OR PRO_DISCOUNT.ENDDATE IS NULL
                        )
                AND     PRO_DISCOUNT.DISCOUNTID = PRO_DISCOUNT_CUSTOMERTYPE.DISCOUNTID
            )

    SELECT 
            CUSTOMERTYPEID as customer_type_id
    FROM    CRM_ACCOUNT
    WHERE   MEMBERID = @MEMBERID
    
END
