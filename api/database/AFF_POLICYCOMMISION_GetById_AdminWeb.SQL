SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[AFF_POLICYCOMMISION_GetById_AdminWeb]
    @POLICYCOMMISIONID BIGINT = 2003
AS
BEGIN

    SELECT 
            AFF_POLICYCOMMISION.POLICYCOMMISIONID,
            AFF_POLICYCOMMISION.POLICYCOMMISIONNAME,
            AFF_POLICYCOMMISION.AFFILIATETYPEID,
            AFF_POLICYCOMMISION.DESCRIPTION,
            AFF_POLICYCOMMISION.ISACTIVE,
            AFF_POLICYCOMMISION.ISDELETED,
            AFF_POLICYCOMMISION.ISLIMITEDTIME,
            IIF(AFF_POLICYCOMMISION.STARTDATEREGISTER IS NOT NULL, FORMAT(AFF_POLICYCOMMISION.STARTDATEREGISTER, 'dd/MM/yyyy'), NULL) AS STARTDATEREGISTERVIEW,
            IIF(AFF_POLICYCOMMISION.ENDDATEREGISTER IS NOT NULL, FORMAT(AFF_POLICYCOMMISION.ENDDATEREGISTER, 'dd/MM/yyyy'), NULL) AS ENDDATEREGISTERVIEW,
            AFF_POLICYCOMMISION.ISDEFAULT
    FROM    AFF_POLICYCOMMISION
    WHERE  AFF_POLICYCOMMISION.POLICYCOMMISIONID = @POLICYCOMMISIONID;

    SELECT 
            AFF_POCOMMISION_DETAIL.POCOMMISIONDETAILID,
            AFF_POCOMMISION_DETAIL.POLICYCOMMISIONID,
            AFF_POCOMMISION_DETAIL.CONDITIONID,
            AFF_POCOMMISION_DETAIL.FROMVALUE,
            AFF_POCOMMISION_DETAIL.TOVALUE,
            AFF_POCOMMISION_DETAIL.TYPE,
            AFF_POCOMMISION_DETAIL.COMISSIONVALUE,
            AFF_CONDITION.CONDITIONNAME,
            AFF_CONDITION.CONDITIONTYPE,
            AFF_CONDITION.ISGROUPSALES,
            AFF_CONDITION.ISPERSONALSALES,
            AFF_CONDITION.ISUSERINTRODUCTION

    FROM    AFF_POCOMMISION_DETAIL

    JOIN    AFF_CONDITION
    ON      AFF_CONDITION.CONDITIONID = AFF_POCOMMISION_DETAIL.CONDITIONID
    AND     AFF_CONDITION.ISACTIVE = 1
    AND     AFF_CONDITION.ISDELETED = 0

    WHERE   AFF_POCOMMISION_DETAIL.ISACTIVE = 1
    AND     AFF_POCOMMISION_DETAIL.ISDELETED = 0
    AND     AFF_POCOMMISION_DETAIL.POLICYCOMMISIONID = @POLICYCOMMISIONID

END
GO
