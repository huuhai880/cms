ALTER PROCEDURE MD_PRODUCT_INTERPRET_GetList_AdminWeb
        @PRODUCTID BIGINT = NULL,
        @ATTRIBUTESGROUPIDS VARCHAR(MAX) = NULL
AS
BEGIN
        CREATE TABLE #TEMP(
            ATTRIBUTEID BIGINT,
            ATTRIBUTENAME NVARCHAR(500),
            INTERPRETID BIGINT,
            BRIEFDESCRIPTION NVARCHAR(MAX),
            ISACTIVE BIT,
            ISINTERPRETSPECIAL BIT,
            ORDERINDEX INT,
            ATTRIBUTESGROUPID BIGINT,
            ISSHOWSEARCHRESULT BIT,
            TEXTURL NVARCHAR(500),
            PROATTRIBUTESID BIGINT,
            INTERPRETDETAILID BIGINT,
            URL NVARCHAR(500),
            ISSELECTED BIT,
            CREATEDDATE DATETIME
        )

        INSERT INTO #TEMP
        (
            ATTRIBUTEID,
            ATTRIBUTENAME,
            INTERPRETID,
            BRIEFDESCRIPTION,
            ISACTIVE,
            ISINTERPRETSPECIAL,
            ORDERINDEX,
            ATTRIBUTESGROUPID,
            ISSHOWSEARCHRESULT,
            TEXTURL,
            PROATTRIBUTESID,
            INTERPRETDETAILID,
            URL,
            ISSELECTED,
            CREATEDDATE
        )
        SELECT 
                    FOR_ATTRIBUTES.ATTRIBUTEID,
                    FOR_ATTRIBUTES.ATTRIBUTENAME,
                    FOR_INTERPRET.INTERPRETID,
                    FOR_INTERPRET.BRIEFDESCRIPTION,
                    FOR_INTERPRET.ISACTIVE,
                    FOR_INTERPRET.ISINTERPRETSPECIAL,
                    FOR_INTERPRET.ORDERINDEX,
                    FOR_ATTRIBUTES.ATTRIBUTESGROUPID,
                    CASE 
                        WHEN MD_PRODUCT_ATTRIBUTES.ISSHOWSEARCHRESULT IS NULL THEN 1 
                        ELSE ISSHOWSEARCHRESULT
                    END AS ISSHOWSEARCHRESULT ,
                    MD_PRODUCT_ATTRIBUTES.TEXTURL,
                    MD_PRODUCT_ATTRIBUTES.PROATTRIBUTESID,
                    MD_PRODUCT_ATTRIBUTES.INTERPRETDETAILID,
                    MD_PRODUCT_ATTRIBUTES.URL,
                    CASE 
                        WHEN MD_PRODUCT_ATTRIBUTES.PROATTRIBUTESID IS NULL THEN 0 
                        ELSE 1
                    END AS ISSELECTED ,
                    FOR_INTERPRET.CREATEDDATE
        
        FROM        FOR_INTERPRET

        JOIN        FOR_ATTRIBUTES
        ON          FOR_ATTRIBUTES.ATTRIBUTEID = FOR_INTERPRET.ATTRIBUTEID
        AND         FOR_ATTRIBUTES.ISACTIVE = 1
        AND         FOR_ATTRIBUTES.ISDELETED = 0

        LEFT JOIN   MD_PRODUCT_ATTRIBUTES
        ON          MD_PRODUCT_ATTRIBUTES.INTERPRETID  = FOR_INTERPRET.INTERPRETID
        AND         MD_PRODUCT_ATTRIBUTES.INTERPRETDETAILID = 0
        AND         MD_PRODUCT_ATTRIBUTES.ISACTIVE = 1
        AND         MD_PRODUCT_ATTRIBUTES.ISDELETED = 0
        AND         MD_PRODUCT_ATTRIBUTES.PRODUCTID = @PRODUCTID

        WHERE       FOR_INTERPRET.ISDELETED = 0
        AND         FOR_INTERPRET.ISACTIVE = 1
        AND         FOR_ATTRIBUTES.ATTRIBUTESGROUPID IN (SELECT CAST(ITEM AS BIGINT) FROM split(@ATTRIBUTESGROUPIDS, ','))
        ORDER BY    FOR_INTERPRET.CREATEDDATE DESC;



        --DANH SACH LUAN GIAI THEO CHI SO
        SELECT 
                ATTRIBUTEID,
                ATTRIBUTENAME,
                INTERPRETID,
                BRIEFDESCRIPTION,
                ISACTIVE,
                ISINTERPRETSPECIAL,
                ORDERINDEX,
                ATTRIBUTESGROUPID,
                ISSHOWSEARCHRESULT,
                TEXTURL,
                PROATTRIBUTESID,
                INTERPRETDETAILID,
                URL,
                ISSELECTED,
                CREATEDDATE
        FROM    #TEMP;

        --DANH SACH LUAN GIAI CHI TIET
        SELECT 
                    FOR_INTERPRETDETAIL.INTERPRETDETAILNAME,
                    FOR_INTERPRETDETAIL.INTERPRETID,
                    FOR_INTERPRETDETAIL.NOTICE,
                    FOR_INTERPRETDETAIL.PARENTID,
                    FOR_INTERPRETDETAIL.SHORTCONTENT,
                    FOR_INTERPRETDETAIL.FULLCONTENT,
                    FOR_INTERPRETDETAIL.ORDERINDEX,
                    FOR_INTERPRETDETAIL.ISACTIVE,
                    --IIF (ISNULL( FOR_INTERPRETDETAIL.PARENTID, 0 ) = 0, '', PARENT.INTERPRETDETAILNAME ) PARENTINTERPRETDETAILNAME,
                    NULL PARENTINTERPRETDETAILNAME,
                    FOR_INTERPRETDETAIL.INTERPRETDETAILID,
                    CASE
                        WHEN MD_PRODUCT_ATTRIBUTES.ISSHOWSEARCHRESULT IS NULL THEN 1 
                        ELSE ISSHOWSEARCHRESULT 
                    END AS ISSHOWSEARCHRESULT,

                    MD_PRODUCT_ATTRIBUTES.TEXTURL,
                    MD_PRODUCT_ATTRIBUTES.PROATTRIBUTESID,
                    MD_PRODUCT_ATTRIBUTES.URL,
                    CASE
                        WHEN MD_PRODUCT_ATTRIBUTES.PROATTRIBUTESID IS NULL THEN 0 
                        ELSE 1 
                    END AS ISSELECTED 

        FROM        FOR_INTERPRETDETAIL

        LEFT JOIN   MD_PRODUCT_ATTRIBUTES
        ON          MD_PRODUCT_ATTRIBUTES.INTERPRETDETAILID = FOR_INTERPRETDETAIL.INTERPRETDETAILID
        AND         MD_PRODUCT_ATTRIBUTES.ISACTIVE = 1
        AND         MD_PRODUCT_ATTRIBUTES.ISDELETED = 0
        AND         MD_PRODUCT_ATTRIBUTES.PRODUCTID = @PRODUCTID
        AND         MD_PRODUCT_ATTRIBUTES.INTERPRETID = FOR_INTERPRETDETAIL.INTERPRETID

        WHERE       FOR_INTERPRETDETAIL.ISACTIVE = 1
        AND         FOR_INTERPRETDETAIL.ISDELETED = 0
        AND         EXISTS 
                    (
                        SELECT 1
                        FROM #TEMP
                        WHERE   #TEMP.INTERPRETID = FOR_INTERPRETDETAIL.INTERPRETID
                    )
        ORDER BY    FOR_INTERPRETDETAIL.ORDERINDEX


        DROP TABLE #TEMP;
END